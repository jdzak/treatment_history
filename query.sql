-- select count(*),
--   case
--     when CAST(SUBSTRING(dp, 1, 4) AS DECIMAL) between 1980 and 1985 then '1980-1985'
--     when CAST(SUBSTRING(dp, 1, 4) AS DECIMAL) between 1986 and 1990 then '1986-1990'
--     when CAST(SUBSTRING(dp, 1, 4) AS DECIMAL) between 1991 and 1995 then '1991-1995'
--     when CAST(SUBSTRING(dp, 1, 4) AS DECIMAL) between 1996 and 2000 then '1996-2000'
--     when CAST(SUBSTRING(dp, 1, 4) AS DECIMAL) between 2001 and 2005 then '2001-2005'
--     when CAST(SUBSTRING(dp, 1, 4) AS DECIMAL) between 2006 and 2010 then '2006-2010'
--     when CAST(SUBSTRING(dp, 1, 4) AS DECIMAL) between 2011 and 2013 then '2011-2013' end as year_range
-- from CITATIONS
-- group by year_range
-- limit 1000;

-- SELECT count(*), s_cui, s_name FROM PREDICATION_AGGREGATE pa join SENTENCE s on s.sentence_id =  pa.sid WHERE predicate = 'TREATS'  AND o_CUI IN('C0153957','C0018787','C1281570','C0153500','C1646326','C0018801','C0018802')  AND s_novel = 1  group by s_cui, s_name order by count(*) desc;

--- Congestive Hearth Failure (Base)
SELECT count(*), s_cui, s_name,
  case
    when CAST(SUBSTRING(dp, 1, 4) AS DECIMAL) between 1980 and 1985 then '1980-1985'
    when CAST(SUBSTRING(dp, 1, 4) AS DECIMAL) between 1986 and 1990 then '1986-1990'
    when CAST(SUBSTRING(dp, 1, 4) AS DECIMAL) between 1991 and 1995 then '1991-1995'
    when CAST(SUBSTRING(dp, 1, 4) AS DECIMAL) between 1996 and 2000 then '1996-2000'
    when CAST(SUBSTRING(dp, 1, 4) AS DECIMAL) between 2001 and 2005 then '2001-2005'
    when CAST(SUBSTRING(dp, 1, 4) AS DECIMAL) between 2006 and 2010 then '2006-2010'
    when CAST(SUBSTRING(dp, 1, 4) AS DECIMAL) between 2011 and 2013 then '2011-2013' end as year_range
FROM PREDICATION_AGGREGATE pa 
join SENTENCE s on s.sentence_id =  pa.sid 
join CITATIONS c on c.pmid = s.pmid
WHERE predicate = 'TREATS'  
AND o_CUI IN('C0153957','C0018787','C1281570','C0153500','C1646326','C0018801','C0018802')  
AND s_novel = 1  
group by s_cui, s_name, year_range
having year_range <> NULL
order by year_range, s_name;

--- Congestive Hearth Failure (With pmids)
SELECT count(*), s_cui, s_name,
  case
    when CAST(SUBSTRING(dp, 1, 4) AS DECIMAL) between 1980 and 1985 then '1980-1985'
    when CAST(SUBSTRING(dp, 1, 4) AS DECIMAL) between 1986 and 1990 then '1986-1990'
    when CAST(SUBSTRING(dp, 1, 4) AS DECIMAL) between 1991 and 1995 then '1991-1995'
    when CAST(SUBSTRING(dp, 1, 4) AS DECIMAL) between 1996 and 2000 then '1996-2000'
    when CAST(SUBSTRING(dp, 1, 4) AS DECIMAL) between 2001 and 2005 then '2001-2005'
    when CAST(SUBSTRING(dp, 1, 4) AS DECIMAL) between 2006 and 2010 then '2006-2010'
    when CAST(SUBSTRING(dp, 1, 4) AS DECIMAL) between 2011 and 2013 then '2011-2013' end as year_range
FROM (select s_cui, s_name, sid, o_cui from PREDICATION_AGGREGATE WHERE pmid IN (19075089,19147446,19165563,19238541,19241160,19259090,19287017,19298563,19327624,19329498,19329820,19395556,19429638,19448327,19464414,19477397,19477400,19561363,19567409,19690393,19699885,19782785,19782789,19789395,19829143,19850207,19880673,19910894,19919976,19937388,20025703,20060737,20123246,20136608,20152247,20176716,20350695,20376643,20425165,20459399,20494923,20513750,20560030,20560033,20569719,20625111,20625642,20650361,20657270,20670760,20670761,20672565,20709866,20795939,20797593,20800804,20801495,20801500,20844613,20974767,21036891,21092890,21098426,21109913,21111923,21125288,21127379,21185153,21208157,21214089,21216832,21252013,21269649,21300298,21353251,21382893,21390582,21402600,21414567,21431901,21442576,21450567,21453215,21463153,21463154,21490036,21516074,21547624,21562061,21565866,21613427,21645332,21712261,21747195,21750125,21813108,21828333,21875862,21900185,21906812,21922233,21939839,21982313,22017475,22034480,22064591,22083298,22088800,22104549,22112740,22123359,22147616,22282104,22285578,22286156,22310153,22340263,22342270,22348447,22369914,22405632,22424012,22427524,22460822,22510230,22549295,22553307,22617188,22696519,22709747,22724260,22727431,22781424,22785005,22808826,22830441,22839442,22848075,22882472,22918216,22922413,22962420,22965994,22989293,23000040,23018991,23032716,23060423,23170968,23174486,23180520,23244364,23245443,23252875,23294824,23308171,23343556,23465286,23500267,23537041,23537892,23540545,23541971,23618535,23622913,23731606,23916925,23942679,23970363,24002794)) pa
join SENTENCE s on s.sentence_id =  pa.sid 
join CITATIONS c on c.pmid = s.pmid
WHERE predicate = 'TREATS'  
AND o_CUI IN('C0153957','C0018787','C1281570','C0153500','C1646326','C0018801','C0018802')  
AND s_novel = 1  
group by s_cui, s_name, year_range
having year_range <> NULL
order by year_range, s_name;

